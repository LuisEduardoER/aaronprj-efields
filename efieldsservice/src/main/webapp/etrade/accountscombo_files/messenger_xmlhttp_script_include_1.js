(Et1.oModel.oMessenger.oRequest.oMechanism.ScriptInclude=Et1.oLang.Class.getConstructor(Object,{S_DATATYPE:"et1.js.framework.model.messenger.request.mechanism.ScriptInclude",S_TYPE:"text/javascript",S_HEAD:"head",S_SCRIPT:"script",S_RS_LOADED:"loaded",S_BUST_CACHE:"bustCache=",init:function(g,l,i,c,a,f){var j=a?a:window,d,k,b=arguments.callee.ownerClass.ReadyStateChangeEvent,e="",h="?";if(Et1.oContext.Platform.isIEonWindows()){if(/\?/.test(g)){h="&"}e=h+this.S_BUST_CACHE+((new Date()).getTime())}this.iSerialNum=c;this.sSrcUrl=g+e;this.sAlertUser=f;this.oTargetDocument=Et1.oDom.Document.getDocument(j);this.ndScript=Element.prep(this.oTargetDocument.createElement(this.S_SCRIPT));this.ndScript.type=this.S_TYPE;this.ndScript.src=this.sSrcUrl;if(typeof this.ndScript.onreadystatechange!="undefined"){k=Et1.getHandler(this.eventLoadedViaReadyState,this);d=function(){k(new b(null,this))};this.ndScript.onreadystatechange=d}else{this.ndScript.addEventListener("load",this.eventLoad,this)}},send:function(){var c=this.oTargetDocument.getElementsByTagName(this.S_HEAD)[0],a=c.getElementsByTagName(this.S_SCRIPT),b;function d(h){var e=a.length,f=[],g;while(e--){g=a[e];if(g&&g.src&&g.src==h){f.push(g)}}e=f.length;while(e--){c.removeChild(f[e])}return f}b=d(this.ndScript.src);c.appendChild(this.ndScript)},eventLoad:function(a){if(this.S_UNIQUE_ID=="et1.js.framework.model.messenger.request.mechanism.ScriptInclude_10"){}this.emitEvent(a);return true},eventLoadedViaReadyState:function(){if(this.ndScript.readyState==this.S_RS_LOADED){this.emitEvent(new arguments.callee.ownerClass.ReadyStateChangeEvent(this.iSerialNum,this))}}})).extend({ReadyStateChangeEvent:function(a,b){this.S_DATATYPE="Et1.oModel.oMessenger.oRequest.oMechanism.ScriptInclude.ReadyStateChangeEvent";this.sType="load";this.oTarget=b;this.iSerialNumber=a;this.sAnnotation="This event is triggered by a script tag element readystate change."}});(Et1.oModel.oMessenger.oRequest.oMechanism.oXml_http.AbstractXmlHttpRequest=Et1.oLang.Class.getConstructor(Object,{S_DATATYPE:"et1.js.framework.model.messenger.xml_http.AbstractXmlHttpRequest",sRequestUrl:"",sMethod:"POST",bAsync:true,init:function(d,g,b,f,a){var e=this,c;this.oXHReq=d;this.iSerialNum=a;this.sRequestUrl=g;this.sMethod=((b==null)?this.sMethod:b);this.bAsync=((f==null)?this.bAsync:f);this.update(g,b,f,a);this.oPlatform=Et1.oContext.Platform;if(this.oXHReq){this.sEventTargetId=Et1.getEventTargetId(this.S_DATATYPE);self.hEventTargets[this.sEventTargetId]=this;c=new Function("","var oXR = self.hEventTargets[ '"+this.sEventTargetId+"' ], \n        oRE = new Et1.oModel.oMessenger.oRequest.oMechanism.oXml_http.AbstractXmlHttpRequest.ReadyStateChangeEvent( null, oXR ); \n    oXR.emitReadyEvent( oRE );\n ");this.oXHReq.onreadystatechange=c;if(this.oPlatform.sRunningOn==this.oPlatform.S_FIREFOX){this.oXHReq.onSynchronousReadyStateChange=c}}},emitReadyEvent:function(){if(this.oXHReq.readyState==4){this.emitEvent(new arguments.callee.ownerClass.ReadyStateChangeEvent(this.iSerialNum,this))}},send:function(p_varMsg,p_bPersistant){var sMsg;with(this){oXHReq.open(sMethod,sRequestUrl,bAsync);if(sMethod=="POST"){oXHReq.setRequestHeader("Content-type","application/x-www-form-urlencoded");if(p_varMsg&&typeof p_varMsg.length=="number"){oXHReq.setRequestHeader("Content-length",p_varMsg.length)}oXHReq.setRequestHeader("X-Requested-With","XMLHttpRequest");if(!p_bPersistant){oXHReq.setRequestHeader("Connection","close")}else{oXHReq.setRequestHeader("Connection","keep-alive")}}}this.oXHReq.send(p_varMsg);if(!this.bAsync&&(this.oPlatform.sRunningOn==this.oPlatform.S_FIREFOX)){this.oXHReq.onSynchronousReadyStateChange()}},update:function(){}})).extend({ReadyStateChangeEvent:function(a,b){this.S_DATATYPE="Et1.oModel.oMessenger.oRequest.oMechanism.oXml_http.AbstractXmlHttpRequest.ReadyStateChangeEvent";this.sType="onreadystatechange";this.oTarget=b;this.iSerialNumber=a},getXmlHttpConstructor:function(){var e=Et1.oModel.oMessenger.oRequest.oMechanism.oXml_http.ActiveXxmlHttpRequest;if(!window.XMLHttpRequest){var a=e.aSignatures,c=0,b=a.length;do{try{new ActiveXObject(a[c]);e.sSignature=a[c];return e}catch(d){}c++}while(c<b);return function(){}}return Et1.oModel.oMessenger.oRequest.oMechanism.oXml_http.StdXmlHttpRequest}});(Et1.oModel.oMessenger.oRequest.oMechanism.oXml_http.ActiveXxmlHttpRequest=Et1.oLang.Class.getConstructor(Et1.oModel.oMessenger.oRequest.oMechanism.oXml_http.AbstractXmlHttpRequest,{S_DATATYPE:"et1.js.framework.model.messenger.xml_http.ActiveXxmlHttpRequest",init:function(d,b,c,a){this.superClass.init.call(this,new ActiveXObject(this.fnConstr.sSignature),d,b,c,a)}})).extend({sSignature:"",aSignatures:["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.5.0","MSXML2.XMLHTTP.4.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"]});Et1.oModel.oMessenger.oRequest.oMechanism.oXml_http.StdXmlHttpRequest=Et1.oLang.Class.getConstructor(Et1.oModel.oMessenger.oRequest.oMechanism.oXml_http.AbstractXmlHttpRequest,{S_DATATYPE:"et1.js.framework.model.messenger.xml_http.StdXmlHttpRequest",init:function(d,b,c,a){this.superClass.init.call(this,new XMLHttpRequest(),d,b,c,a)},update:function(){var a=this.oXHReq.onreadystatechange;if(Et1.oContext.Platform.sRunningOn==Et1.oContext.Platform.S_FIREFOX){this.oXHReq=new XMLHttpRequest();this.oXHReq.onreadystatechange=a;this.oXHReq.onSynchronousReadyStateChange=a}}});(Et1.oModel.oMessenger.oRequest.Request=Et1.oLang.Class.getConstructor(Object,{S_DATATYPE:"et1.js.framework.model.Messenger.Request.Request",B_PERSISTANT:false,S_EVENT_RS:"onreadystatechange",S_EVENT_LOAD:"load",H_MECHANISM_TYPES:{"xml-http":(Et1.oModel.oMessenger.oRequest.oMechanism.oXml_http.AbstractXmlHttpRequest?Et1.oModel.oMessenger.oRequest.oMechanism.oXml_http.AbstractXmlHttpRequest.getXmlHttpConstructor():null),"json-iframe":null,"clonejax-iframe":(Et1.oModel.oMessenger.oRequest.oMechanism.oClonejax.Clonejax?Et1.oModel.oMessenger.oRequest.oMechanism.oClonejax.Clonejax:null),"script-include":(Et1.oModel.oMessenger.oRequest.oMechanism.ScriptInclude?Et1.oModel.oMessenger.oRequest.oMechanism.ScriptInclude:null),"json-script-include":null},S_DEFAULT_COOKIE_AUTH_TOKEN:"SMSESSION",S_DEFAULT_COOKIE_USER_NAME:"user",S_DEFAULT_COOKIE_CLIENT_ID:"WRC_ID",I_MAX_OLD_MECHANISMS:200,I_OLD_MECHANISM_BUFFER_SIZE:120,bAsynchronous:true,bFinished:false,bReceivedAResponse:false,bResponseOk:true,iSerialNumber:-1,prv_bIsHandshake:false,sMechanism:"xml-http",sMethod:"POST",sProtocol:"plain",sRequestUrl:"",sAuthScheme:"none",iSendsSinceLastMemoryFreeing:0,bWaitForUpdateSemaphore:false,baseInit:function(){if(Et1.oModel.oMessenger.oRequest.oMechanism.oUtils.JsonSerializer){this.oJsonSerializer=new Et1.oModel.oMessenger.oRequest.oMechanism.oUtils.JsonSerializer()}},init:function(d,a,e,g,h,b,f,c){this.iSerialNumber=++arguments.callee.ownerClass.iSerialNumber;this.bAsynchronous=(e==null)?this.bAsynchronous:e;this.sMechanism=(h==null)?this.sMechanism:h;this.sMethod=(a==null)?this.sMethod:a;this.sProtocol=(g==null)?this.sProtocol:g;this.sRequestUrl=(d==null)?this.sRequestUrl:d;this.sAuthScheme=(b==null)?this.sAuthScheme:b;this.oTargetWindow=(f==null)?document.getElementById(Et1.oModel.oMessenger.oRequest.Request.S_DEFAULT_IFRAME_ID):f;this.sAlertUser=c;this.oLastSent=null;this.oRequestMechanism=null;this.aMechanismsToFree=[]},send:function(e,c,a,b){var g=this.H_MECHANISM_TYPES[this.sMechanism],d,f;if(++this.iSendsSinceLastMemoryFreeing>this.I_MAX_OLD_MECHANISMS){this.prv_removeListeners();this.iSendsSinceLastMemoryFreeing=0}if(c){if(!a){a=""}if(typeof e=="object"){f=(a+this.oJsonSerializer.serialize(e,true,b))}else{if(typeof e=="undefined"){f=(a+"undefined")}else{if(typeof e!="string"){f=(a+e.toString())}}}}else{if(typeof e=="undefined"){f=null}else{f=e}}if(g){d=this.oRequestMechanism=new g(this.sRequestUrl,this.sMethod,this.bAsynchronous,this.iSerialNumber,this.oTargetWindow,this.sAlertUser);this.prv_setListeners(d)}else{throw new Error(this.sMechanism+" not supported.")}this.oRequestMechanism.send(f,this.B_PERSISTANT);this.oLastSent=new Date()},freeAllMechanisms:function(){this.prv_removeListeners(true)},prv_setListeners:function(b){var a,c;switch(this.sMechanism){case"xml-http":a=b.addEventListener(this.S_EVENT_RS,this.eventReadyStateChange,this);break;default:c=b.addEventListener(this.S_EVENT_LOAD,this.eventLoad,this)}this.aMechanismsToFree.push(new this.FreeMechanismData(b,a,c))},prv_removeListeners:function(g){var h=this.aMechanismsToFree,e=0,c=h.length,b,f,d,a;if(!g){c=c-this.I_OLD_MECHANISM_BUFFER_SIZE;if(c<1){return}}for(;e<c;e++){d=this.aMechanismsToFree[e];a=d.oMechanism;if(d.oOnReadyStateChangeListenerProxy){a.removeEventListener(d.oOnReadyStateChangeListenerProxy)}if(d.oOnLoadListenerProxy){a.removeEventListener(d.oOnLoadListenerProxy)}if(a.removeEventReferences){a.removeEventReferences()}this.aMechanismsToFree[e]=null}this.aMechanismsToFree.splice(0,c)},ResponseReceivedEvent:function(d,b,c,a){this.S_DATATYPE="et1.js.framework.model.Messenger.Request.ResponseReceivedEvent";this.sType="responsereceived";this.constructor.constructor.setProperties(this,["sMechanism","oRequest","oResponse","iSerialNumber"],arguments)},eventReadyStateChange:function(b){var a=this.oRequestMechanism.oXHReq;this.bReceivedAResponse=true;this.bResponseOk=this.prv_isXmlHttpResponseOk(a);this.prv_markFinished();if(!this.bResponseOk){return false}this.emitResponseReceivedEvent(a);return true},emitResponseReceivedEvent:function(a){var b;if(this.sProtocol=="plain"){this.bFinished=true}b=new this.ResponseReceivedEvent(this.oRequestMechanism,this,a,this.iSerialNumber);this.emitEvent(b)},eventLoad:function(a){this.bReceivedAResponse=true;this.bResponseOk=true;this.prv_markFinished();this.emitResponseReceivedEvent(a);return true},prv_isXmlHttpResponseOk:function(a){try{if(a.status>399){return true}}catch(b){this.oRequestMechanism.oResponse=null;return false}return true},getClientId:function(b){var a=b?b:this.S_DEFAULT_COOKIE_CLIENT_ID;return this.prv_getCookieValue(a)},getUser:function(b){var a=b?b:this.S_DEFAULT_COOKIE_USER_NAME;return this.prv_getCookieValue(a)},getAuthToken:function(a){var b=a?a:this.S_DEFAULT_COOKIE_AUTH_TOKEN;return this.prv_getCookieValue(b)},prv_getCookieValue:function(a){var b=document.cookie.match(new RegExp(sPropName+"=([^;]*)"));if(b&&b.length){return b[1]}return""},prv_markFinished:function(){bFinished=true},FreeMechanismData:function(a,b,c){this.oMechanism=a;this.oOnReadyStateChangeListenerProxy=b;this.oOnLoadListenerProxy=c}})).extend({iSerialNumber:-1,S_DEFAULT_IFRAME_ID:"et1-communications-iframe-1"});Et1.oModel.oMessenger.Messenger=Et1.oLang.Class.getConstructor(Object,{S_DATATYPE:"et1.js.framework.model.messenger.Messenger",S_DEFAULT_TRANSPORT_TYPE:"xml-http-plain",S_ENSURE_REFRESH:"ensureRefresh=",H_TRANSPORT_NAMES:{S_HTTP_PLAIN:"xml-http-plain",S_XML_HTTP_BAYEUX:"xml-http-bayeux",S_CLONEJAX_IFRAME_PLAIN:"clonejax-iframe-plain",S_JSON_IFRAME_PLAIN:"json-iframe-plain",S_JSON_IFRAME_BAYEUX:"json-iframe-bayeux",S_SCRIPT_INCLUDE_PLAIN:"script-include-plain"},R_COMET:/bayeux|grizzly/,S_HANDSHAKE:"handshake",I_SEMAPHORE_DELAY_MS:50,hPersistantConnections:{},bWaitForUpdateSemaphore:false,bSingleton:true,init:function(){this.H_TRANSPORT_TYPES={"xml-http-plain":Et1.oModel.oMessenger.oRequest.Request,"xml-http-bayeux":Et1.oModel.oMessenger.oRequest.oPersistant.Request,"clonejax-iframe-plain":Et1.oModel.oMessenger.oRequest.Request,"json-iframe-plain":null,"json-iframe-bayeux":null,"script-include-plain":Et1.oModel.oMessenger.oRequest.Request};this.hRequests={}},send:function(a,t,f,k,g,m,o,n,e,b,l){var u=f.replace(/^event/,"").toLowerCase(),d=t[f],v,r,w,h,q,s,i,j,p,c;w=(o==null)?this.S_DEFAULT_TRANSPORT_TYPE:o;s=this.addEventListener(u,d,t);v=this.H_TRANSPORT_TYPES[w];h=this.extractProtocolNameFromTransportType(w);q=this.extractMechanismNameFromTransportType(w);i=this.R_COMET.test(w);if(i){r=this.hPersistantConnections[a]}if(!r){r=new v(a,k,g,h,q,n,e,b);c=r.addEventListener("responsereceived",this.eventResponseReceived,this);this.hRequests[r.iSerialNumber]=new this.RequestDataBag(r,u,new Date(),c);if(i){p=r.addEventListener(r.S_COMET_ERROR,d,t);this.hPersistantConnections[a]=r}}r.send(m,l);return[r.fnConstr.iSerialNumber,s,p]},sendComet:function(c,b,d){var a=this.send(c,b,d,null,null,this.S_HANDSHAKE,this.H_TRANSPORT_NAMES.S_XML_HTTP_BAYEUX,null,null,null,true);a=[this.hPersistantConnections[c],a[1],a[2]];return a},extractMechanismNameFromTransportType:function(a){return(a.replace(/\-\w+$/,""))},extractProtocolNameFromTransportType:function(a){return(a.match(/\-(\w+)$/)[1])},eventResponseReceived:function(b){if(this.bWaitForUpdateSemaphore){Et1.getThread(this.eventResponseReceived,this,[b],this.I_SEMAPHORE_DELAY_MS);return}this.bWaitForUpdateSemaphore=true;var a=this.hRequests[b.iSerialNumber];this.emitMessageReceivedEvent(b);if(b.oRequest.bFinished){a.oReqEngine.removeEventListener(a.oLpResponseReceived);this.hRequests[b.iSerialNumber]=null}this.bWaitForUpdateSemaphore=false},emitMessageReceivedEvent:function(a){var c=a,b=c.iSerialNumber,d=this.hRequests[b];this.emitEvent(new this.MessageReceivedEvent(d.sApplicationEventName,c.sType,c.oRequest,c.oResponse,b))},RequestDataBag:function(d,c,b,a){this.S_DATATYPE="et1.js.framework.model.Messenger.MessageReceivedEvent.RequestDataBag";this.constructor.constructor.setProperties(this,["oReqEngine","sApplicationEventName","oDateSent","oLpResponseReceived"],arguments)},MessageReceivedEvent:function(d,e,b,c,a){this.S_DATATYPE="et1.js.framework.model.Messenger.MessageReceivedEvent";this.constructor.constructor.setProperties(this,["sType","sMechanism","oRequest","oResponse","iSerialNumber"],arguments)},beamJs:function(p_sInputOrTextAreaId){var oJs=document.getElementById(p_sInputOrTextAreaId);if(oJs){oJs.parentNode.removeChild(oJs);return(eval("( function(){ return "+oJs.value+" } )();"))}else{log("No source for the JavaScript to beam up.");return null}},getXmlResponse:function(b){var c=b,d,a;if(typeof DOMParser=="undefined"){return c.responseXML}try{d=c.documentElement}catch(e){d=void 0}if(typeof d=="undefined"){a=c.responseText;if(a){return((new DOMParser()).parseFromString(a,"text/xml"))}else{return c.responseXML}}return c.responseXML},uniqueifySrcs:function(c){var b=c.getElementsByTagName("*"),a=b.length;while(a--){if(b[a].src){b[a].src=this.bustCache(b[a].src)}}},bustCache:function(d){var c=new RegExp("("+this.S_ENSURE_REFRESH+")(\\d+)"),e=(c.test(d)),b=((new Date()).getTime()),a;if(e){d=d.replace(c,"$1"+b);return}a=/\?./.test(d)?"&":"?";return(d+a+this.S_ENSURE_REFRESH+b)}});